# プロフィールLPメーカー - 要件定義書

## 📋 ドキュメント情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | プロフィールLPメーカー |
| バージョン | 1.0.0 |
| 作成日 | 2024年12月9日 |
| 最終更新日 | 2024年12月9日 |
| ステータス | 実装完了 |

---

## 1. プロジェクト概要

### 1.1 背景と目的

#### 背景
- 個人事業主やフリーランスが自己PRやサービス紹介をする際、専門的なWebサイト制作スキルが必要
- 既存のリンクまとめサービス（Linktree等）では表現力に限界がある
- LP（ランディングページ）制作は高額（10万円〜）で、個人には手が届きにくい

#### 目的
- **ノーコードで美しいプロフィールLPを作成できるツールを提供**
- **個人の魅力を最大限に引き出すデザインと機能**
- **リード獲得やコンバージョンにつながる仕組み**

### 1.2 ターゲットユーザー

#### プライマリーターゲット
1. **個人事業主・フリーランス**
   - コーチ、コンサルタント
   - Webデザイナー、エンジニア
   - ライター、翻訳者

2. **コンテンツクリエイター**
   - Kindle作家
   - YouTuber、ブロガー
   - オンライン講師

3. **情報発信者**
   - インフルエンサー
   - 専門家（士業、講師）
   - 副業・起業家

#### セカンダリーターゲット
- 中小企業の経営者
- イベント主催者
- 店舗オーナー

### 1.3 提供価値

| 価値 | 説明 |
|------|------|
| **簡単操作** | ドラッグ&ドロップで直感的にLP作成 |
| **豊富な表現力** | 12種類のブロックで多様なコンテンツ表現 |
| **プロフェッショナル** | 業種別テンプレートで即座にプロ品質 |
| **データドリブン** | 詳細なアナリティクスで効果測定 |
| **リード獲得** | メールアドレス収集機能でリスト構築 |
| **低コスト** | 基本無料、Pro機能も500円〜 |

---

## 2. 機能要件

### 2.1 認証機能

#### FR-AUTH-001: ユーザー登録
- **概要**: メールアドレスとパスワードでアカウント作成
- **入力項目**:
  - メールアドレス（必須）
  - パスワード（必須、8文字以上）
- **処理**:
  1. Supabase Authでユーザー作成
  2. 確認メールを送信
  3. メールリンクをクリックして認証完了
- **成功条件**: ユーザーがauth.usersテーブルに登録される
- **エラー処理**:
  - メールアドレス重複: 「このメールアドレスは既に登録されています」
  - パスワード不正: 「パスワードは8文字以上で設定してください」

#### FR-AUTH-002: ログイン
- **概要**: メールアドレスとパスワードでログイン
- **入力項目**:
  - メールアドレス（必須）
  - パスワード（必須）
- **処理**:
  1. Supabase Authで認証
  2. セッションを確立
  3. ダッシュボードにリダイレクト
- **成功条件**: ユーザーがログイン状態になる
- **エラー処理**:
  - 認証失敗: 「メールアドレスまたはパスワードが正しくありません」

#### FR-AUTH-003: ログアウト
- **概要**: ログアウト処理
- **処理**:
  1. Supabase Authでセッション削除
  2. トップページにリダイレクト
- **成功条件**: ユーザーがログアウト状態になる

#### FR-AUTH-004: パスワードリセット
- **概要**: パスワードを忘れた場合のリセット
- **処理**:
  1. メールアドレスを入力
  2. リセットメールを送信
  3. メールリンクから新パスワードを設定
- **成功条件**: パスワードが更新される

---

### 2.2 プロフィール作成・編集機能

#### FR-PROFILE-001: 新規プロフィール作成
- **概要**: 新しいプロフィールLPを作成
- **アクセス**: `/dashboard/editor/new`
- **前提条件**: ユーザーがログイン済み
- **処理**:
  1. デフォルトブロック（ヘッダー、テキストカード、リンク）を表示
  2. ユーザーがブロックを編集
  3. スラッグ（URL）を設定
  4. 保存ボタンをクリック
  5. Supabaseのprofilesテーブルに保存
- **成功条件**: プロフィールが作成され、ダッシュボードに表示される
- **制約**:
  - スラッグは一意である必要がある
  - スラッグは英数字とハイフンのみ

#### FR-PROFILE-002: 既存プロフィール編集
- **概要**: 作成済みプロフィールを編集
- **アクセス**: `/dashboard/editor/[slug]`
- **前提条件**: 
  - ユーザーがログイン済み
  - プロフィールの作成者である
- **処理**:
  1. Supabaseから既存データを読み込み
  2. ブロックを編集
  3. 保存ボタンをクリック
  4. Supabaseのprofilesテーブルを更新
- **成功条件**: プロフィールが更新される

#### FR-PROFILE-003: プロフィール削除
- **概要**: プロフィールを削除
- **前提条件**: 
  - ユーザーがログイン済み
  - プロフィールの作成者である
- **処理**:
  1. 削除確認ダイアログを表示
  2. 確認後、Supabaseから削除
  3. ダッシュボードにリダイレクト
- **成功条件**: プロフィールが削除される
- **注意**: 削除は取り消せない

#### FR-PROFILE-004: プロフィール公開
- **概要**: プロフィールを公開URLで閲覧可能にする
- **公開URL**: `/p/[slug]`
- **処理**:
  1. 保存時に自動的に公開される
  2. 誰でもURLで閲覧可能
- **成功条件**: 公開URLでプロフィールが表示される

---

### 2.3 ブロックシステム

#### FR-BLOCK-001: ブロック追加
- **概要**: 新しいブロックをプロフィールに追加
- **対応ブロック**: 12種類（後述）
- **処理**:
  1. 「ブロック追加」ボタンをクリック
  2. ブロックタイプを選択
  3. ブロックが末尾に追加される
  4. 自動的に編集モードになる
- **成功条件**: ブロックが追加され、プレビューに表示される

#### FR-BLOCK-002: ブロック編集
- **概要**: ブロックの内容を編集
- **処理**:
  1. ブロックをクリックして展開
  2. 各フィールドを編集
  3. リアルタイムでプレビューに反映
- **成功条件**: 編集内容がプレビューに即座に反映される

#### FR-BLOCK-003: ブロック削除
- **概要**: ブロックを削除
- **処理**:
  1. 削除ボタン（ゴミ箱アイコン）をクリック
  2. 確認なしで即座に削除
- **成功条件**: ブロックが削除される
- **注意**: 削除は取り消せない（保存前なら再読み込みで復元可能）

#### FR-BLOCK-004: ブロック並び替え
- **概要**: ブロックの順序を変更
- **操作方法**:
  - 上下矢印ボタンで移動
  - ドラッグ&ドロップで移動（将来実装）
- **処理**:
  1. 矢印ボタンをクリック
  2. ブロックが1つ上または下に移動
  3. プレビューに即座に反映
- **成功条件**: ブロックの順序が変更される

---

### 2.4 ブロックタイプ詳細

#### FR-BLOCK-TYPE-001: ヘッダーブロック
- **用途**: プロフィール画像、名前、キャッチコピー
- **フィールド**:
  - プロフィール画像（画像URL、アップロード可能）
  - 名前（テキスト、必須）
  - キャッチコピー（テキスト、必須）
  - カテゴリ（選択式: ビジネス、クリエイター、コーチ、その他）
- **表示**: 
  - 円形のプロフィール画像
  - 名前（大きめのフォント）
  - キャッチコピー（サブタイトル）
  - カテゴリアイコン

#### FR-BLOCK-TYPE-002: テキストカードブロック
- **用途**: タイトル付きのテキストコンテンツ
- **フィールド**:
  - タイトル（テキスト、必須）
  - 本文（テキストエリア、必須、改行可能）
  - 配置（選択式: 左寄せ、中央寄せ）
- **表示**: 
  - 半透明の白いカード
  - タイトル（太字）
  - 本文（通常フォント）

#### FR-BLOCK-TYPE-003: 画像ブロック
- **用途**: 画像の表示
- **フィールド**:
  - 画像（画像URL、アップロード可能、必須）
  - キャプション（テキスト、オプション）
- **表示**: 
  - 画像（レスポンシブ）
  - キャプション（画像下）

#### FR-BLOCK-TYPE-004: YouTubeブロック
- **用途**: YouTube動画の埋め込み
- **フィールド**:
  - YouTube URL（テキスト、必須）
- **処理**:
  1. URLから動画IDを抽出
  2. iframeで埋め込み
- **対応形式**:
  - `https://www.youtube.com/watch?v=VIDEO_ID`
  - `https://youtu.be/VIDEO_ID`
- **表示**: 
  - レスポンシブな動画プレイヤー

#### FR-BLOCK-TYPE-005: リンクブロック
- **用途**: SNSリンクやWebサイトへのリンクボタン
- **フィールド**:
  - リンク一覧（配列）
    - ラベル（テキスト、必須）
    - URL（テキスト、必須）
    - スタイル（選択式: デフォルト、オレンジ、グリーン等）
- **操作**:
  - リンク追加ボタン
  - リンク削除ボタン
  - 並び替え（上下移動）
- **表示**: 
  - ボタン形式のリンク
  - クリックでリンク先に遷移
  - クリック数をトラッキング

#### FR-BLOCK-TYPE-006: Kindleブロック
- **用途**: Kindle本の紹介カード
- **フィールド**:
  - ASIN（テキスト、必須）
  - 画像URL（画像、アップロード可能、必須）
  - タイトル（テキスト、必須）
  - 説明文（テキストエリア、必須）
- **表示**: 
  - 本の表紙画像
  - タイトル
  - 説明文
  - Amazonへのリンクボタン

#### FR-BLOCK-TYPE-007: リードフォームブロック
- **用途**: メールアドレス収集
- **フィールド**:
  - タイトル（テキスト、必須）
  - ボタンテキスト（テキスト、必須）
- **表示**: 
  - タイトル
  - メールアドレス入力欄
  - 送信ボタン
- **処理**:
  1. メールアドレスを入力
  2. 送信ボタンをクリック
  3. Supabaseのleadsテーブルに保存
  4. 「登録ありがとうございます」メッセージ表示

#### FR-BLOCK-TYPE-008: LINE登録ブロック
- **用途**: LINE公式アカウントへの誘導
- **フィールド**:
  - タイトル（テキスト、必須）
  - 説明文（テキストエリア、必須）
  - LINE URL（テキスト、必須）
  - ボタンテキスト（テキスト、必須）
  - QRコード画像（画像、オプション）
- **表示**: 
  - タイトル
  - 説明文
  - LINEボタン
  - QRコード（あれば）

#### FR-BLOCK-TYPE-009: FAQブロック
- **用途**: よくある質問と回答
- **フィールド**:
  - FAQ一覧（配列）
    - 質問（テキスト、必須）
    - 回答（テキストエリア、必須）
- **操作**:
  - FAQ追加ボタン
  - FAQ削除ボタン
  - 並び替え（上下移動）
- **表示**: 
  - アコーディオン形式
  - 質問をクリックで回答を展開

#### FR-BLOCK-TYPE-010: 料金表ブロック
- **用途**: サービスプランや価格の表示
- **フィールド**:
  - プラン一覧（配列）
    - タイトル（テキスト、必須）
    - 価格（テキスト、必須）
    - 特徴一覧（配列、テキスト）
    - おすすめフラグ（チェックボックス）
- **操作**:
  - プラン追加ボタン
  - プラン削除ボタン
  - 特徴追加・削除ボタン
- **表示**: 
  - カード形式のプラン表示
  - おすすめプランは目立つデザイン

#### FR-BLOCK-TYPE-011: お客様の声ブロック
- **用途**: 推薦文、レビュー、お客様の声
- **フィールド**:
  - お客様の声一覧（配列）
    - 名前（テキスト、必須）
    - 役職・肩書き（テキスト、必須）
    - コメント（テキストエリア、必須）
    - 画像（画像URL、オプション）
- **操作**:
  - お客様の声追加ボタン
  - お客様の声削除ボタン
- **表示**: 
  - カード形式
  - 画像（あれば円形で表示）
  - 名前と役職
  - コメント

#### FR-BLOCK-TYPE-012: クイズブロック
- **用途**: 診断クイズの埋め込み（将来拡張）
- **フィールド**:
  - クイズID（テキスト、オプション）
  - クイズスラッグ（テキスト、オプション）
  - カスタムタイトル（テキスト、オプション）
- **表示**: 
  - クイズプレイヤーの埋め込み
- **注意**: 現在は未実装、将来的に診断クイズメーカーと連携予定

---

### 2.5 テンプレート機能

#### FR-TEMPLATE-001: テンプレート一覧表示
- **概要**: 業種別のテンプレートを表示
- **テンプレート**:
  1. ビジネス・コンサルタント
  2. Kindle作家・コンテンツ販売
  3. メンタルコーチ・サロン
- **表示内容**:
  - テンプレート名
  - 説明文
  - プレビュー画像（将来実装）
  - 「このテンプレートを使う」ボタン

#### FR-TEMPLATE-002: テンプレート適用
- **概要**: テンプレートをワンクリックで適用
- **処理**:
  1. テンプレートを選択
  2. 確認ダイアログ表示（既存の内容が上書きされる旨）
  3. 確認後、テンプレートのブロックとテーマを適用
  4. プレビューに即座に反映
- **成功条件**: テンプレートが適用される
- **注意**: 既存の内容は上書きされる（保存前なら再読み込みで復元可能）

---

### 2.6 AI自動生成機能

#### FR-AI-001: AI自動生成
- **概要**: OpenAI APIを使用してプロフィールを自動生成
- **入力項目**:
  - 職業（テキスト、必須）
  - ターゲット（テキスト、必須）
  - 強み（テキスト、必須）
- **処理**:
  1. AIモーダルを開く
  2. 3つの項目を入力
  3. 「生成」ボタンをクリック
  4. OpenAI APIにリクエスト
  5. 生成されたブロックを適用
  6. プレビューに即座に反映
- **成功条件**: AIが生成したブロックが表示される
- **エラー処理**:
  - API失敗: 「生成に失敗しました。もう一度お試しください」
  - 入力不足: 「すべての項目を入力してください」

---

### 2.7 テーマ・デザイン機能

#### FR-THEME-001: グラデーション背景設定
- **概要**: プロフィールの背景をグラデーションに設定
- **プリセット**:
  - デフォルト（青系）
  - サンセット（オレンジ系）
  - フォレスト（緑系）
  - オーシャン（青緑系）
  - ラベンダー（紫系）
- **処理**:
  1. テーマ設定モーダルを開く
  2. グラデーションを選択
  3. プレビューに即座に反映
- **成功条件**: 背景が変更される

#### FR-THEME-002: カスタム背景画像設定
- **概要**: 独自の背景画像をアップロード
- **処理**:
  1. テーマ設定モーダルを開く
  2. 「背景画像をアップロード」ボタンをクリック
  3. 画像を選択
  4. Supabase Storageにアップロード
  5. プレビューに即座に反映
- **制約**:
  - ファイル形式: JPEG, PNG, GIF, WebP
  - ファイルサイズ: 最大10MB
- **成功条件**: 背景画像が設定される

---

### 2.8 ダッシュボード機能

#### FR-DASHBOARD-001: プロフィール一覧表示
- **概要**: 作成したプロフィールの一覧を表示
- **表示内容**:
  - プロフィール名（ヘッダーブロックの名前）
  - スラッグ（URL）
  - アクセス数
  - クリック数
  - クリック率
  - 精読率
  - 平均滞在時間
  - 作成日時
  - 更新日時
- **操作**:
  - 編集ボタン → エディタに遷移
  - 削除ボタン → 削除確認ダイアログ
  - 公開URLボタン → 新しいタブで公開ページを開く
  - QRコードボタン → QRコード表示モーダル

#### FR-DASHBOARD-002: プロフィール作成
- **概要**: 新規プロフィール作成ページに遷移
- **処理**:
  1. 「新規作成」ボタンをクリック
  2. `/dashboard/editor/new` に遷移

#### FR-DASHBOARD-003: リード一覧表示
- **概要**: 収集したメールアドレスの一覧を表示
- **表示内容**:
  - メールアドレス
  - プロフィール名
  - 登録日時
- **操作**:
  - CSVダウンロードボタン → CSV形式でダウンロード

---

### 2.9 アナリティクス機能

#### FR-ANALYTICS-001: ページビュートラッキング
- **概要**: プロフィールページの閲覧数を記録
- **トリガー**: プロフィールページが読み込まれた時
- **記録内容**:
  - profile_id
  - event_type: 'view'
  - event_data: {}
  - created_at
- **成功条件**: analyticsテーブルにレコードが追加される

#### FR-ANALYTICS-002: クリックトラッキング
- **概要**: リンクやボタンのクリック数を記録
- **トリガー**: リンク、ボタン、Kindleカード等がクリックされた時
- **記録内容**:
  - profile_id
  - event_type: 'click'
  - event_data: { url: 'https://...' }
  - created_at
- **成功条件**: analyticsテーブルにレコードが追加される

#### FR-ANALYTICS-003: スクロール深度トラッキング
- **概要**: ページのスクロール深度を記録
- **トリガー**: 25%, 50%, 75%, 100%のマイルストーンに到達した時
- **記録内容**:
  - profile_id
  - event_type: 'scroll'
  - event_data: { scrollDepth: 50 }
  - created_at
- **成功条件**: analyticsテーブルにレコードが追加される

#### FR-ANALYTICS-004: 滞在時間トラッキング
- **概要**: ページの滞在時間を記録
- **トリガー**: 30秒ごと
- **記録内容**:
  - profile_id
  - event_type: 'time'
  - event_data: { timeSpent: 30 }
  - created_at
- **成功条件**: analyticsテーブルにレコードが追加される

#### FR-ANALYTICS-005: 精読判定トラッキング
- **概要**: ページを50%以上スクロールしたことを記録
- **トリガー**: 50%以上スクロールした時（1回のみ）
- **記録内容**:
  - profile_id
  - event_type: 'read'
  - event_data: { readPercentage: 75 }
  - created_at
- **成功条件**: analyticsテーブルにレコードが追加される

#### FR-ANALYTICS-006: アナリティクス集計表示
- **概要**: ダッシュボードでアナリティクスを表示
- **表示指標**:
  - アクセス数（viewイベントの数）
  - クリック数（clickイベントの数）
  - クリック率（クリック数 ÷ アクセス数 × 100）
  - 精読率（readイベントの数 ÷ アクセス数 × 100）
  - 平均滞在時間（timeイベントの平均）
- **更新**: リアルタイム（ページ読み込み時に取得）

---

### 2.10 決済機能（Stripe連携）

#### FR-PAYMENT-001: Pro機能購入フロー
- **概要**: プロフィールごとにPro機能を購入
- **Pro機能**:
  - HTMLダウンロード
  - 埋め込みコード発行
- **価格**: 500円〜50,000円（ユーザーが自由に設定）
- **処理**:
  1. ダッシュボードで「機能開放 / 寄付」ボタンをクリック
  2. 金額入力プロンプト表示
  3. 金額を入力（500〜50,000円）
  4. Stripe Checkout Sessionを作成
  5. Stripeの決済ページにリダイレクト
  6. カード情報を入力して決済
  7. 決済完了後、ダッシュボードに戻る
  8. 決済検証・購入履歴記録
  9. Pro機能が開放される
- **成功条件**: 
  - profile_purchasesテーブルにレコードが追加される
  - HTMLダウンロード・埋め込みコードが利用可能になる

#### FR-PAYMENT-002: 決済検証
- **概要**: 決済完了後、Stripeに決済状態を確認
- **処理**:
  1. URLパラメータから session_id を取得
  2. /api/verify-profile にPOSTリクエスト
  3. Stripe APIで決済状態を確認
  4. 決済が完了していれば、profile_purchasesに記録
  5. 重複チェック（stripe_session_idがユニーク）
- **成功条件**: 購入履歴が記録される
- **エラー処理**:
  - 決済未完了: 「決済が完了していません」
  - 重複決済: 「この決済は既に記録されています」

#### FR-PAYMENT-003: HTMLダウンロード
- **概要**: プロフィールを静的HTMLファイルとしてダウンロード
- **前提条件**: Pro機能を購入済み
- **処理**:
  1. 「HTMLダウンロード」ボタンをクリック
  2. プロフィールデータから完全なHTMLを生成
  3. ファイルとしてダウンロード
- **生成内容**:
  - HTML構造
  - インラインCSS
  - インラインJavaScript
  - 外部依存なし
- **成功条件**: HTMLファイルがダウンロードされる

#### FR-PAYMENT-004: 埋め込みコード発行
- **概要**: プロフィールを外部サイトに埋め込むコードを発行
- **前提条件**: Pro機能を購入済み
- **処理**:
  1. 「埋め込みコード」ボタンをクリック
  2. iframeコードを表示
  3. コピーボタンでクリップボードにコピー
- **コード形式**:
```html
<iframe 
  src="https://yoursite.com/p/[slug]" 
  width="100%" 
  height="600" 
  frameborder="0"
></iframe>
```
- **成功条件**: 埋め込みコードが表示される

---

### 2.11 リード獲得機能

#### FR-LEAD-001: メールアドレス収集
- **概要**: リードフォームブロックでメールアドレスを収集
- **処理**:
  1. ユーザーがメールアドレスを入力
  2. 送信ボタンをクリック
  3. Supabaseのleadsテーブルに保存
  4. 「登録ありがとうございます」メッセージ表示
- **成功条件**: leadsテーブルにレコードが追加される
- **エラー処理**:
  - メールアドレス不正: 「正しいメールアドレスを入力してください」
  - 保存失敗: 「登録に失敗しました。もう一度お試しください」

#### FR-LEAD-002: リード一覧表示
- **概要**: ダッシュボードでリード一覧を表示
- **前提条件**: ユーザーがログイン済み
- **表示内容**:
  - メールアドレス
  - プロフィール名
  - 登録日時
- **フィルター**: プロフィールごとに絞り込み可能
- **成功条件**: リード一覧が表示される

#### FR-LEAD-003: リードCSV出力
- **概要**: リードをCSV形式でダウンロード
- **処理**:
  1. 「CSVダウンロード」ボタンをクリック
  2. CSV形式でファイルを生成
  3. ダウンロード
- **CSV形式**:
```csv
メールアドレス,プロフィール名,登録日時
example@example.com,山田太郎,2024-12-09 10:00:00
```
- **成功条件**: CSVファイルがダウンロードされる

---

### 2.12 管理者機能

#### FR-ADMIN-001: ユーザー一覧表示
- **概要**: 全ユーザーの情報を表示
- **前提条件**: 管理者権限を持つユーザーがログイン済み
- **表示内容**:
  - ユーザーID
  - メールアドレス
  - 登録日時
  - 最終ログイン日時
  - メール確認日時
  - プロフィール作成数
  - 購入数
- **成功条件**: ユーザー一覧が表示される

#### FR-ADMIN-002: ユーザー情報CSV出力
- **概要**: ユーザー情報をCSV形式でダウンロード
- **処理**:
  1. 「CSVダウンロード」ボタンをクリック
  2. /api/export-users-csv にGETリクエスト
  3. CSV形式でファイルを生成
  4. ダウンロード
- **CSV形式**:
```csv
ユーザーID,メールアドレス,登録日時,最終ログイン,メール確認,プロフィール数,購入数
xxx,user@example.com,2024-12-09,2024-12-09,2024-12-09,3,1
```
- **成功条件**: CSVファイルがダウンロードされる

#### FR-ADMIN-003: Googleスプレッドシート連携
- **概要**: ユーザー情報を自動的にGoogleスプレッドシートに送信
- **前提条件**: GOOGLE_SHEETS_WEBHOOK_URLが設定されている
- **処理**:
  1. 「Googleスプレッドシートに送信」ボタンをクリック
  2. /api/export-users-sheets にPOSTリクエスト
  3. Google Apps ScriptのWebhookにデータを送信
  4. スプレッドシートに自動追記
- **成功条件**: スプレッドシートにデータが追加される

---

### 2.13 外部計測タグ連携

#### FR-TRACKING-001: Google Tag Manager連携
- **概要**: GTM IDを設定してGoogle Tag Managerを有効化
- **設定方法**:
  1. エディタで「設定」ボタンをクリック
  2. 「GTM ID」を入力（例: GTM-XXXXXXX）
  3. 保存
- **処理**: 公開ページの`<head>`にGTMスクリプトを挿入
- **成功条件**: GTMが動作し、タグが発火する

#### FR-TRACKING-002: Facebook Pixel連携
- **概要**: FB Pixel IDを設定してFacebook Pixelを有効化
- **設定方法**:
  1. エディタで「設定」ボタンをクリック
  2. 「FB Pixel ID」を入力（例: 123456789012345）
  3. 保存
- **処理**: 公開ページの`<head>`にFB Pixelスクリプトを挿入
- **成功条件**: FB Pixelが動作し、イベントがトラッキングされる

#### FR-TRACKING-003: LINE Tag連携
- **概要**: LINE Tag IDを設定してLINE Tagを有効化
- **設定方法**:
  1. エディタで「設定」ボタンをクリック
  2. 「LINE Tag ID」を入力
  3. 保存
- **処理**: 公開ページの`<head>`にLINE Tagスクリプトを挿入
- **成功条件**: LINE Tagが動作し、コンバージョンがトラッキングされる

---

### 2.14 その他の機能

#### FR-OTHER-001: QRコード生成
- **概要**: プロフィールページへのQRコードを生成
- **処理**:
  1. ダッシュボードで「QRコード」ボタンをクリック
  2. QRコードモーダルを表示
  3. QRコードを画像として表示
  4. ダウンロードボタンでPNG形式でダウンロード
- **成功条件**: QRコードが表示・ダウンロードされる

#### FR-OTHER-002: トップページ掲載設定
- **概要**: プロフィールをトップページに掲載するかどうかを設定
- **設定方法**:
  1. エディタで「設定」ボタンをクリック
  2. 「トップページに掲載する」チェックボックスを操作
  3. 保存
- **デフォルト**: チェックあり（掲載する）
- **処理**: 
  - チェックあり: featured_on_top = true
  - チェックなし: featured_on_top = false
- **成功条件**: トップページの掲載状態が変更される

---

## 3. 非機能要件

### 3.1 パフォーマンス

#### NFR-PERF-001: ページ読み込み速度
- **要件**: 初回ページ読み込みが3秒以内
- **測定方法**: Lighthouse、PageSpeed Insights
- **対策**:
  - Next.jsの静的生成（SSG）を活用
  - 画像の最適化（WebP、遅延読み込み）
  - CDNの活用（Vercel Edge Network）

#### NFR-PERF-002: エディタの応答速度
- **要件**: ブロック編集時のプレビュー更新が0.5秒以内
- **対策**:
  - Reactの最適化（useMemo、useCallback）
  - 不要な再レンダリングの防止

#### NFR-PERF-003: データベースクエリ
- **要件**: データベースクエリが1秒以内
- **対策**:
  - 適切なインデックスの設定
  - N+1問題の回避
  - Server Actionsの活用

---

### 3.2 セキュリティ

#### NFR-SEC-001: 認証・認可
- **要件**: Supabase Authによる安全な認証
- **対策**:
  - メール認証の必須化
  - パスワードの強度チェック（8文字以上）
  - セッションの自動期限切れ

#### NFR-SEC-002: Row Level Security (RLS)
- **要件**: データベースアクセスはRLSで制御
- **対策**:
  - 全テーブルでRLSを有効化
  - ユーザーは自分のデータのみアクセス可能
  - 公開データは誰でも閲覧可能

#### NFR-SEC-003: XSS対策
- **要件**: クロスサイトスクリプティング（XSS）を防止
- **対策**:
  - Reactの自動エスケープ機能
  - dangerouslySetInnerHTMLの使用を最小限に
  - ユーザー入力のサニタイズ

#### NFR-SEC-004: CSRF対策
- **要件**: クロスサイトリクエストフォージェリ（CSRF）を防止
- **対策**:
  - Next.jsのCSRF保護機能
  - Server Actionsの使用

#### NFR-SEC-005: 画像アップロードセキュリティ
- **要件**: 安全な画像アップロード
- **対策**:
  - ファイル形式の制限（JPEG, PNG, GIF, WebP）
  - ファイルサイズの制限（最大10MB）
  - ファイル名のサニタイズ

---

### 3.3 可用性

#### NFR-AVAIL-001: 稼働率
- **要件**: 99.9%以上の稼働率
- **対策**:
  - Vercelの高可用性インフラ
  - Supabaseの冗長化構成

#### NFR-AVAIL-002: エラーハンドリング
- **要件**: すべてのエラーを適切に処理
- **対策**:
  - try-catchによるエラーキャッチ
  - ユーザーフレンドリーなエラーメッセージ
  - エラーログの記録

---

### 3.4 スケーラビリティ

#### NFR-SCALE-001: ユーザー数
- **要件**: 10,000ユーザーまで対応
- **対策**:
  - Supabaseの自動スケーリング
  - Vercelのオートスケーリング

#### NFR-SCALE-002: プロフィール数
- **要件**: 100,000プロフィールまで対応
- **対策**:
  - データベースのインデックス最適化
  - ページネーション実装

---

### 3.5 ユーザビリティ

#### NFR-USAB-001: レスポンシブデザイン
- **要件**: PC、タブレット、スマホで最適表示
- **対策**:
  - Tailwind CSSのレスポンシブクラス
  - モバイルファーストの設計

#### NFR-USAB-002: アクセシビリティ
- **要件**: WCAG 2.1 レベルAA準拠
- **対策**:
  - セマンティックHTML
  - キーボード操作対応
  - スクリーンリーダー対応

#### NFR-USAB-003: 多言語対応
- **要件**: 日本語のみ（将来的に英語対応）
- **対策**:
  - i18nの準備（将来実装）

---

### 3.6 保守性

#### NFR-MAINT-001: コード品質
- **要件**: 可読性の高いコード
- **対策**:
  - TypeScriptによる型安全性
  - ESLintによるコード規約
  - コメントの適切な記述

#### NFR-MAINT-002: ドキュメント
- **要件**: 包括的なドキュメント
- **対策**:
  - README.md
  - SETUP_GUIDE.md
  - PROJECT_SPECIFICATION.md
  - EDITOR_FILES_GUIDE.md
  - REQUIREMENTS.md（本ドキュメント）

---

## 4. 制約事項

### 4.1 技術的制約

| 制約 | 内容 |
|------|------|
| フレームワーク | Next.js 16.x（App Router） |
| データベース | Supabase（PostgreSQL） |
| 認証 | Supabase Auth |
| 決済 | Stripe |
| ホスティング | Vercel（推奨） |
| ブラウザ対応 | Chrome, Firefox, Safari, Edge（最新版） |

### 4.2 ビジネス制約

| 制約 | 内容 |
|------|------|
| 無料プラン | 基本機能はすべて無料 |
| Pro機能価格 | 500円〜50,000円（ユーザー設定） |
| 管理者権限 | 手動で設定（データベース直接編集） |
| サポート | コミュニティベース（将来的に有料サポート） |

### 4.3 運用制約

| 制約 | 内容 |
|------|------|
| バックアップ | Supabaseの自動バックアップ |
| モニタリング | Vercel Analytics、Supabase Dashboard |
| デプロイ | Gitプッシュで自動デプロイ |

---

## 5. 用語集

| 用語 | 説明 |
|------|------|
| プロフィールLP | プロフィール紹介用のランディングページ |
| ブロック | プロフィールを構成する要素（ヘッダー、テキスト、画像など） |
| スラッグ | URL用の識別子（例: my-profile） |
| リード | メールアドレス等の見込み客情報 |
| Pro機能 | 有料で開放される機能（HTML DL、埋め込み） |
| RLS | Row Level Security（行レベルセキュリティ） |
| Server Action | Next.jsのサーバーサイド処理 |
| アナリティクス | アクセス解析・ユーザー行動分析 |
| 精読率 | ページを50%以上スクロールした割合 |
| クリック率 | クリック数 ÷ アクセス数 × 100 |

---

## 6. 参考資料

### 内部ドキュメント
- [README.md](README.md) - プロジェクト概要とセットアップ手順
- [PROJECT_SPECIFICATION.md](PROJECT_SPECIFICATION.md) - 総合仕様書
- [EDITOR_FILES_GUIDE.md](EDITOR_FILES_GUIDE.md) - エディタ関連ファイル一覧
- [SETUP_GUIDE.md](SETUP_GUIDE.md) - セットアップガイド
- [ANALYTICS_SETUP.md](ANALYTICS_SETUP.md) - アナリティクス機能セットアップ
- [PAYMENT_IMPLEMENTATION_SUMMARY.md](PAYMENT_IMPLEMENTATION_SUMMARY.md) - 決済システム実装レポート
- [PERMISSION_DESIGN.md](PERMISSION_DESIGN.md) - 権限管理システム設計
- [MARKETING_STRATEGY.md](MARKETING_STRATEGY.md) - マーケティング戦略

### 外部リソース
- [Next.js Documentation](https://nextjs.org/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [Stripe Documentation](https://stripe.com/docs)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)

---

## 7. 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|----------|--------|
| 1.0.0 | 2024-12-09 | 初版作成 | AI Assistant |

---

## 8. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトオーナー | - | - | - |
| 開発リーダー | - | - | - |
| レビュアー | - | - | - |

---

**以上**

