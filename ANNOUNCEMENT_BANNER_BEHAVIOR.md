# お知らせバナーの動作仕様

## 🎯 ×ボタンの動作

### 基本動作

```
┌────────────────────────────────────────────────┐
│ 🔔 新機能を追加しました！               [×]   │
└────────────────────────────────────────────────┘
                                           ↑
                                    クリックすると...
```

1. **そのお知らせが非表示になる**
2. **お知らせのIDがローカルストレージに保存される**
3. **同じお知らせは二度と表示されない**
4. **新しいお知らせが投稿されると、再び表示される**

---

## 📊 動作フロー

### シナリオ1: 通常の使用

```
【ステップ1】
管理者が「お知らせA」を投稿（ID: 123）
  ↓
【ステップ2】
ユーザーがページを開く
  ↓
バナーに「お知らせA」が表示される
  ↓
【ステップ3】
ユーザーが×ボタンをクリック
  ↓
localStorage に保存: dismissed_announcement_id = "123"
  ↓
バナーが非表示になる
  ↓
【ステップ4】
ユーザーが別のページに移動してもバナーは表示されない
（同じお知らせAは表示されない）
```

---

### シナリオ2: 新しいお知らせが投稿された場合

```
【前提】
ユーザーは「お知らせA（ID: 123）」を×で閉じた
localStorage: dismissed_announcement_id = "123"
  ↓
【ステップ1】
管理者が「お知らせB」を投稿（ID: 456）
  ↓
【ステップ2】
ユーザーがページをリロード
  ↓
システムが最新のお知らせを取得
→ お知らせB（ID: 456）
  ↓
localStorageをチェック
→ 保存されているID: 123
→ 現在のお知らせID: 456
→ 一致しない！
  ↓
【結果】
バナーに「お知らせB」が表示される ✅
（新しいお知らせは表示される！）
```

---

### シナリオ3: お知らせが更新された場合

```
【前提】
管理者が「お知らせA（ID: 123）」を編集
→ タイトルや内容を変更
→ IDは変わらない（123のまま）
  ↓
【結果】
ユーザーには表示されない ❌
（同じIDのお知らせは表示されない）

【対策】
重要な変更の場合は、新しいお知らせとして投稿してください
```

---

## 💾 ローカルストレージの仕組み

### 保存される情報

```javascript
// キー: dismissed_announcement_id
// 値: 閉じたお知らせのID（UUID）

localStorage.setItem('dismissed_announcement_id', 'a1b2c3d4-e5f6-7890-abcd-ef1234567890');
```

### 保存されるタイミング

- ユーザーが×ボタンをクリックした時

### 削除されるタイミング

- ユーザーがブラウザのキャッシュをクリアした時
- 開発者が手動で削除した時

### 上書きされるタイミング

- ユーザーが別のお知らせの×ボタンをクリックした時
- **最新の1件のみ記録される**

---

## 🔍 具体例

### 例1: 毎日新しいお知らせを投稿する場合

```
12月1日: お知らせA（ID: 001）を投稿
  → ユーザーが×で閉じる
  → localStorage: 001

12月2日: お知らせB（ID: 002）を投稿
  → ユーザーがページを開く
  → バナーに「お知らせB」が表示される ✅

12月3日: お知らせC（ID: 003）を投稿
  → ユーザーがページを開く
  → バナーに「お知らせC」が表示される ✅
```

**結果:** 毎日新しいお知らせが表示される

---

### 例2: 同じお知らせを長期間表示する場合

```
12月1日: お知らせA（ID: 001）を投稿
  → ユーザーが×で閉じる
  → localStorage: 001

12月2日: 新しいお知らせなし
  → ユーザーがページを開く
  → バナーは表示されない ❌
  （最新のお知らせがID: 001で、既に閉じている）

12月3日: 新しいお知らせなし
  → ユーザーがページを開く
  → バナーは表示されない ❌
```

**結果:** ユーザーが×で閉じたら、新しいお知らせが投稿されるまで表示されない

---

### 例3: お知らせを編集した場合

```
12月1日: お知らせA（ID: 001）を投稿
  タイトル: 「新機能追加」
  → ユーザーが×で閉じる
  → localStorage: 001

12月2日: お知らせA（ID: 001）を編集
  タイトル: 「新機能追加（重要）」
  → ユーザーがページを開く
  → バナーは表示されない ❌
  （IDが同じため、既に閉じたと判定される）
```

**対策:** 重要な変更の場合は、新しいお知らせとして投稿してください

---

## 🎨 管理者向けのベストプラクティス

### ✅ 推奨する運用方法

#### 1. 定期的に新しいお知らせを投稿
```
週1回、または月1回のペースで新しいお知らせを投稿
→ ユーザーが×で閉じても、次回は新しいお知らせが表示される
```

#### 2. 重要なお知らせは「全サービス共通」に
```
サービス区分: 全サービス共通
→ 紫色のバナーで目立つ
→ 「重要」バッジが表示される
```

#### 3. タイトルは短く簡潔に
```
❌ 悪い例: 「プロフィールLPメーカーに新しい機能を追加しました。詳細はこちらをご覧ください。」
✅ 良い例: 「新機能追加のお知らせ」
```

#### 4. 重要な変更は新規投稿
```
既存のお知らせを編集するのではなく、
新しいお知らせとして投稿する
→ ユーザーに確実に届く
```

---

### ❌ 避けるべき運用方法

#### 1. 同じお知らせを長期間表示
```
1ヶ月間、同じお知らせを表示し続ける
→ ユーザーが×で閉じたら、1ヶ月間表示されない
→ 重要な情報が届かない可能性
```

#### 2. お知らせの編集で内容を大幅変更
```
既存のお知らせのタイトルや内容を大幅に変更
→ IDが変わらないため、既に閉じたユーザーには表示されない
```

#### 3. 頻繁にお知らせを投稿
```
1日に何度もお知らせを投稿
→ ユーザーが煩わしく感じる可能性
→ ×で閉じられやすくなる
```

---

## 🔧 開発者向け情報

### ローカルストレージのリセット方法

#### ブラウザのコンソールで実行
```javascript
localStorage.removeItem('dismissed_announcement_id');
```

#### すべてのローカルストレージをクリア
```javascript
localStorage.clear();
```

### 動作確認方法

#### 1. お知らせを表示
```
1. 管理者でお知らせを作成
2. ページをリロード
3. バナーが表示されることを確認
```

#### 2. ×ボタンの動作確認
```
1. ×ボタンをクリック
2. バナーが非表示になることを確認
3. ページをリロード
4. バナーが表示されないことを確認
```

#### 3. 新しいお知らせの表示確認
```
1. 管理者で新しいお知らせを作成
2. ページをリロード
3. 新しいバナーが表示されることを確認
```

#### 4. ローカルストレージの確認
```
1. ブラウザの開発者ツールを開く
2. Application タブ > Local Storage
3. dismissed_announcement_id の値を確認
```

---

## 📝 まとめ

### ユーザー視点
- ✅ ×で閉じたお知らせは二度と表示されない
- ✅ 新しいお知らせは自動的に表示される
- ✅ 煩わしい通知を避けられる

### 管理者視点
- ✅ 定期的に新しいお知らせを投稿すれば、確実にユーザーに届く
- ✅ 重要な変更は新規投稿で対応
- ✅ 編集ではなく新規投稿を推奨

### 技術的な仕組み
- ✅ ローカルストレージでIDを記録
- ✅ 最新の1件のみ表示
- ✅ IDが一致しない場合は表示

---

**作成日:** 2025年12月10日  
**最終更新:** 2025年12月10日  
**バージョン:** 1.0.0


