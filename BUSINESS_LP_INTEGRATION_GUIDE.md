# ãƒ“ã‚¸ãƒã‚¹LPãƒ¡ãƒ¼ã‚«ãƒ¼çµ±åˆã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ç›®æ¬¡

1. [ã¯ã˜ã‚ã«](#ã¯ã˜ã‚ã«)
2. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®ç†è§£](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®ç†è§£)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
4. [ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥](#ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥)
5. [å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ´»ç”¨](#å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ´»ç”¨)
6. [Server Actionsã®æ´»ç”¨](#server-actionsã®æ´»ç”¨)
7. [æ±ºæ¸ˆå‡¦ç†ã®å®Ÿè£…](#æ±ºæ¸ˆå‡¦ç†ã®å®Ÿè£…)
8. [ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®å®Ÿè£…](#ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®å®Ÿè£…)
9. [ã‚ˆãã‚ã‚‹ãƒã‚°ã¨å¯¾ç­–](#ã‚ˆãã‚ã‚‹ãƒã‚°ã¨å¯¾ç­–)
10. [ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ»ç½®æ›ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#ã‚³ãƒ¼ãƒ‰æ¤œç´¢ç½®æ›ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)
11. [å®Ÿè£…ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ](#å®Ÿè£…ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ)

---

## ã¯ã˜ã‚ã«

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€**ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPãƒ¡ãƒ¼ã‚«ãƒ¼**ã‚’ãƒ™ãƒ¼ã‚¹ã«**ãƒ“ã‚¸ãƒã‚¹LPãƒ¡ãƒ¼ã‚«ãƒ¼**ã‚’æ§‹ç¯‰ã™ã‚‹éš›ã®çµ±åˆã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

### èƒŒæ™¯

- ãƒ“ã‚¸ãƒã‚¹LPãƒ¡ãƒ¼ã‚«ãƒ¼ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’ãƒ•ã‚©ãƒ«ãƒ€ã”ã¨ã‚³ãƒ”ãƒ¼ã—ã¦ä½œæˆ
- åŒã˜Supabase DBã‚’ä½¿ç”¨ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã¯åˆ†é›¢ï¼‰
- Vercelã§ã¯åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤
- URLãƒªãƒ³ã‚¯ã®é–“é•ã„ãŒå¤šç™ºã—ã¦ã„ã‚‹èª²é¡ŒãŒã‚ã‚‹

### ã“ã®ã‚¬ã‚¤ãƒ‰ã®ç›®çš„

1. **å…±é€šéƒ¨åˆ†ã‚’åŠ¹ç‡çš„ã«æ´»ç”¨**ï¼šé‡è¤‡ã‚³ãƒ¼ãƒ‰ã‚’æ¸›ã‚‰ã—ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã‚’å‘ä¸Š
2. **ãƒã‚°ã‚’é˜²æ­¢**ï¼šURLãƒªãƒ³ã‚¯é–“é•ã„ã‚„DBæ··åœ¨ã‚’é˜²ã
3. **å®Ÿè£…ã‚¹ãƒ”ãƒ¼ãƒ‰å‘ä¸Š**ï¼šæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’æ­£ã—ãå†åˆ©ç”¨

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®ç†è§£

### 2ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–¢ä¿‚æ€§

```mermaid
graph LR
    ProfileLP[ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPãƒ¡ãƒ¼ã‚«ãƒ¼]
    BusinessLP[ãƒ“ã‚¸ãƒã‚¹LPãƒ¡ãƒ¼ã‚«ãƒ¼]
    SharedDB[(Supabase DB)]
    
    ProfileLP -->|profiles ãƒ†ãƒ¼ãƒ–ãƒ«| SharedDB
    BusinessLP -->|business_projects ãƒ†ãƒ¼ãƒ–ãƒ«| SharedDB
    
    ProfileLP -->|å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ| BusinessLP
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒãƒƒãƒ”ãƒ³ã‚°è¡¨

| æ©Ÿèƒ½ | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LP | ãƒ“ã‚¸ãƒã‚¹LP | å‚™è€ƒ |
|-----|-------------|-----------|------|
| **å…¬é–‹ãƒšãƒ¼ã‚¸** | `app/p/[slug]/page.tsx` | `app/b/[slug]/page.tsx` | URLãƒ‘ã‚¹å¤‰æ›´ |
| **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** | `app/dashboard/page.tsx` | `app/business/dashboard/page.tsx` | ãƒ‘ã‚¹å¤‰æ›´ |
| **ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆæ–°è¦ï¼‰** | `app/dashboard/editor/new/page.tsx` | `app/business/dashboard/editor/new/page.tsx` | ãƒ‘ã‚¹å¤‰æ›´ |
| **ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆç·¨é›†ï¼‰** | `app/dashboard/editor/[slug]/page.tsx` | `app/business/dashboard/editor/[slug]/page.tsx` | ãƒ‘ã‚¹å¤‰æ›´ |
| **ãƒãƒ©ã‚·å°åˆ·** | ãªã— | `app/b/[slug]/flyer/page.tsx` | ãƒ“ã‚¸ãƒã‚¹LPå°‚ç”¨ |
| **æ±ºæ¸ˆAPI** | `app/api/checkout-profile/` | `app/api/business-checkout/` | APIåå¤‰æ›´ |
| **æ¤œè¨¼API** | `app/api/verify-profile/` | `app/api/business-verify/` | APIåå¤‰æ›´ |
| **å‰Šé™¤API** | `app/api/delete-profile/` | `app/api/business-delete/` | APIåå¤‰æ›´ |
| **AIç”ŸæˆAPI** | `app/api/generate-profile/` | `app/api/business-generate/` | APIåå¤‰æ›´ |

### å…±é€šéƒ¨åˆ†ã¨å·®ç•°

#### å®Œå…¨ã«å…±é€šï¼ˆãã®ã¾ã¾ä½¿ãˆã‚‹ï¼‰

- èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆSupabase Authï¼‰
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- åŸºæœ¬çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆHeader, Footer, AuthModalï¼‰
- ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®ä»•çµ„ã¿ï¼ˆ`content_type`ã§åŒºåˆ¥ï¼‰
- æ±ºæ¸ˆã®ä»•çµ„ã¿ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ†ã‘ã‚‹ï¼‰

#### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¿…è¦

- ã‚¨ãƒ‡ã‚£ã‚¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒç•°ãªã‚‹ï¼‰
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«åãŒç•°ãªã‚‹ï¼‰
- ãƒ–ãƒ­ãƒƒã‚¯ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ï¼ˆãƒ“ã‚¸ãƒã‚¹LPç”¨ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ï¼‰
- Server Actionsï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«åãŒç•°ãªã‚‹ï¼‰

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«å¯¾å¿œè¡¨

| ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LP | ãƒ“ã‚¸ãƒã‚¹LP | ç”¨é€” |
|-------------|-----------|------|
| `profiles` | `business_projects` | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‡ãƒ¼ã‚¿ |
| `profile_purchases` | `business_project_purchases` | è³¼å…¥å±¥æ­´ |
| `analytics` (content_type='profile') | `analytics` (content_type='business') | ã‚¢ã‚¯ã‚»ã‚¹è§£æ |
| `leads` | `leads` | ãƒªãƒ¼ãƒ‰åé›†ï¼ˆå…±é€šï¼‰ |

### profiles vs business_projects

#### profiles ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE profiles (
  id BIGSERIAL PRIMARY KEY,
  slug TEXT UNIQUE NOT NULL,
  nickname TEXT,
  content JSONB NOT NULL,
  settings JSONB,
  user_id UUID REFERENCES auth.users(id),
  featured_on_top BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### business_projects ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE business_projects (
  id BIGSERIAL PRIMARY KEY,
  slug TEXT UNIQUE NOT NULL,
  nickname TEXT,
  content JSONB NOT NULL,
  settings JSONB,
  user_id UUID REFERENCES auth.users(id),
  featured_on_top BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**é‡è¦**: æ§‹é€ ã¯åŒã˜ã ãŒã€ãƒ†ãƒ¼ãƒ–ãƒ«åãŒç•°ãªã‚‹ï¼

### ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE analytics (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  profile_id UUID NOT NULL,  -- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«IDã¾ãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID
  event_type TEXT NOT NULL,  -- 'view', 'click', 'scroll', 'time', 'read'
  event_data JSONB,
  content_type TEXT NOT NULL CHECK (content_type IN ('profile', 'business', 'quiz')),
  created_at TIMESTAMP DEFAULT NOW()
);
```

**é‡è¦**: `content_type`ã§åŒºåˆ¥ã™ã‚‹ï¼
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LP: `content_type = 'profile'`
- ãƒ“ã‚¸ãƒã‚¹LP: `content_type = 'business'`

### æ±ºæ¸ˆãƒ†ãƒ¼ãƒ–ãƒ«

#### profile_purchases

```sql
CREATE TABLE profile_purchases (
  id BIGSERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  profile_id BIGINT REFERENCES profiles(id),
  stripe_session_id TEXT UNIQUE NOT NULL,
  amount INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### business_project_purchases

```sql
CREATE TABLE business_project_purchases (
  id BIGSERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  project_id BIGINT REFERENCES business_projects(id),
  stripe_session_id TEXT UNIQUE NOT NULL,
  amount INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

**é‡è¦**: è³¼å…¥å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å®Œå…¨ã«åˆ†é›¢ï¼

---

## ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥

### URLæ§‹é€ ã®å¯¾å¿œè¡¨

| æ©Ÿèƒ½ | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LP | ãƒ“ã‚¸ãƒã‚¹LP |
|-----|-------------|-----------|
| **ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸** | `/` | `/` |
| **å…¬é–‹ãƒšãƒ¼ã‚¸** | `/p/[slug]` | `/b/[slug]` |
| **ãƒãƒ©ã‚·å°åˆ·** | ãªã— | `/b/[slug]/flyer` |
| **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** | `/dashboard` | `/business/dashboard` |
| **æ–°è¦ä½œæˆ** | `/dashboard/editor/new` | `/business/dashboard/editor/new` |
| **ç·¨é›†ãƒšãƒ¼ã‚¸** | `/dashboard/editor/[slug]` | `/business/dashboard/editor/[slug]` |
| **æ±ºæ¸ˆAPI** | `/api/checkout-profile` | `/api/business-checkout` |
| **æ¤œè¨¼API** | `/api/verify-profile` | `/api/business-verify` |
| **å‰Šé™¤API** | `/api/delete-profile` | `/api/business-delete` |
| **AIç”ŸæˆAPI** | `/api/generate-profile` | `/api/business-generate` |

### ã‚ˆãã‚ã‚‹URLãƒªãƒ³ã‚¯é–“é•ã„ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

#### âŒ é–“é•ã„ä¾‹1: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‘ã‚¹

```javascript
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPã®ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼
<a href="/p/my-profile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¦‹ã‚‹</a>
```

#### âœ… æ­£ã—ã„ä¾‹1: ãƒ“ã‚¸ãƒã‚¹LPç”¨ã«ä¿®æ­£

```javascript
// ãƒ“ã‚¸ãƒã‚¹LPç”¨ã«ä¿®æ­£
<a href="/b/my-business">ãƒ“ã‚¸ãƒã‚¹LPã‚’è¦‹ã‚‹</a>
```

#### âŒ é–“é•ã„ä¾‹2: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®é–“é•ã„

```javascript
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
window.location.href = '/dashboard';
```

#### âœ… æ­£ã—ã„ä¾‹2: ãƒ“ã‚¸ãƒã‚¹LPç”¨ã«ä¿®æ­£

```javascript
// ãƒ“ã‚¸ãƒã‚¹LPã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
window.location.href = '/business/dashboard';
```

#### âŒ é–“é•ã„ä¾‹3: APIå‘¼ã³å‡ºã—ã®é–“é•ã„

```javascript
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç”¨ã®APIã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹
const response = await fetch('/api/checkout-profile', {
  method: 'POST',
  body: JSON.stringify({ profileId, amount })
});
```

#### âœ… æ­£ã—ã„ä¾‹3: ãƒ“ã‚¸ãƒã‚¹LPç”¨ã«ä¿®æ­£

```javascript
// ãƒ“ã‚¸ãƒã‚¹LPç”¨ã®APIã‚’å‘¼ã³å‡ºã™
const response = await fetch('/api/business-checkout', {
  method: 'POST',
  body: JSON.stringify({ projectId, amount })
});
```

### URLæ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å®Ÿè£…å‰ã«ä»¥ä¸‹ã‚’ç¢ºèªï¼š

- [ ] å…¬é–‹ãƒšãƒ¼ã‚¸ã®ãƒ‘ã‚¹ã¯ `/b/[slug]` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ‘ã‚¹ã¯ `/business/dashboard` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] ã‚¨ãƒ‡ã‚£ã‚¿ã®ãƒ‘ã‚¹ã¯ `/business/dashboard/editor/...` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] APIå‘¼ã³å‡ºã—ã¯ `/api/business-*` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã¯æ­£ã—ã„ã‹ï¼Ÿ
- [ ] ãƒªãƒ³ã‚¯ã®hrefã¯æ­£ã—ã„ã‹ï¼Ÿ
- [ ] æ±ºæ¸ˆå¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLã¯æ­£ã—ã„ã‹ï¼Ÿ

---

## å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ´»ç”¨

### ãã®ã¾ã¾ä½¿ãˆã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. Header.jsx

**å ´æ‰€**: `components/Header.jsx`

**ç”¨é€”**: ã‚µã‚¤ãƒˆå…¨ä½“ã®ãƒ˜ãƒƒãƒ€ãƒ¼

**ä½¿ã„æ–¹**:
```jsx
import Header from '@/components/Header';

<Header 
  setPage={setPage} 
  user={user} 
  onLogout={handleLogout}
  setShowAuth={setShowAuth}
/>
```

**æ³¨æ„ç‚¹**: 
- `setPage`é–¢æ•°ã§ãƒšãƒ¼ã‚¸é·ç§»ã‚’åˆ¶å¾¡
- ãƒ“ã‚¸ãƒã‚¹LPç”¨ã«ä½¿ã†å ´åˆã€ãƒšãƒ¼ã‚¸åã‚’é©åˆ‡ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹

#### 2. Footer.jsx

**å ´æ‰€**: `components/Footer.jsx`

**ç”¨é€”**: ã‚µã‚¤ãƒˆå…¨ä½“ã®ãƒ•ãƒƒã‚¿ãƒ¼

**ä½¿ã„æ–¹**:
```jsx
import Footer from '@/components/Footer';

<Footer 
  setPage={setPage}
  onCreate={handleCreate}
  user={user}
  setShowAuth={setShowAuth}
  variant="dark" // ã¾ãŸã¯ "light"
/>
```

#### 3. AuthModal.jsx

**å ´æ‰€**: `components/AuthModal.jsx`

**ç”¨é€”**: ãƒ­ã‚°ã‚¤ãƒ³ãƒ»æ–°è¦ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«

**ä½¿ã„æ–¹**:
```jsx
import AuthModal from '@/components/AuthModal';

<AuthModal
  isOpen={showAuth}
  onClose={() => setShowAuth(false)}
  setUser={setUser}
  isPasswordReset={showPasswordReset}
  setShowPasswordReset={setShowPasswordReset}
  onNavigate={setPage}
/>
```

**æ³¨æ„ç‚¹**: 
- å®Œå…¨ã«å…±é€šã§ä½¿ãˆã‚‹
- èªè¨¼ã¯Supabase Authãªã®ã§ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPã¨ãƒ“ã‚¸ãƒã‚¹LPã§åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

#### 4. AnnouncementBanner.jsx

**å ´æ‰€**: `components/AnnouncementBanner.jsx`

**ç”¨é€”**: ãŠçŸ¥ã‚‰ã›ãƒãƒŠãƒ¼è¡¨ç¤º

**ä½¿ã„æ–¹**:
```jsx
import AnnouncementBanner from '@/components/AnnouncementBanner';

<AnnouncementBanner serviceType="business" />
```

**æ³¨æ„ç‚¹**: 
- `serviceType`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§è¡¨ç¤ºã™ã‚‹ãŠçŸ¥ã‚‰ã›ã‚’åˆ¶å¾¡
- `serviceType="business"` ã§ãƒ“ã‚¸ãƒã‚¹LPç”¨ã®ãŠçŸ¥ã‚‰ã›ã®ã¿è¡¨ç¤º
- `serviceType="all"` ã§å…¨ã‚µãƒ¼ãƒ“ã‚¹å…±é€šã®ãŠçŸ¥ã‚‰ã›ã‚’è¡¨ç¤º

### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. ProfileViewTracker.tsx â†’ BusinessViewTracker.tsx

**å ´æ‰€**: `components/ProfileViewTracker.tsx`ï¼ˆå‚è€ƒï¼‰

**å¤‰æ›´ç‚¹**:
```typescript
// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç‰ˆ
<ProfileViewTracker 
  profileId={profile.id} 
  contentType="profile"  // â† ã“ã“ãŒé‡è¦
/>

// ãƒ“ã‚¸ãƒã‚¹LPç‰ˆ
<BusinessViewTracker 
  projectId={project.id} 
  contentType="business"  // â† 'business' ã«å¤‰æ›´
/>
```

**å®Ÿè£…ä¾‹**:
```typescript
'use client';

import { useEffect, useRef } from 'react';
import { saveAnalytics } from '@/app/actions/analytics';

export function BusinessViewTracker({ 
  projectId, 
  contentType = 'business'  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ 'business' ã«
}: { 
  projectId: string;
  contentType?: 'business';
}) {
  // ... ProfileViewTracker.tsx ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼
  // profileId â†’ projectId ã«ç½®æ›
  // contentType ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ 'business' ã«å¤‰æ›´
}
```

#### 2. LinkClickTracker.tsx

**å ´æ‰€**: `components/LinkClickTracker.tsx`

**ä½¿ã„æ–¹**: ãã®ã¾ã¾ä½¿ãˆã‚‹ï¼

```typescript
import { LinkClickTracker } from '@/components/LinkClickTracker';

const { handleClick } = LinkClickTracker({ 
  profileId: project.id,  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’æ¸¡ã™
  url: link.url 
});

<a href={link.url} onClick={handleClick}>
  {link.label}
</a>
```

**æ³¨æ„ç‚¹**: 
- `profileId`ã¨ã„ã†åå‰ã ãŒã€ãƒ“ã‚¸ãƒã‚¹LPã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’æ¸¡ã—ã¦OK
- ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã¯`profile_id`ã‚«ãƒ©ãƒ ã«ä¿å­˜ã•ã‚Œã‚‹ï¼ˆåå‰ã¯æ°—ã«ã—ãªã„ï¼‰
- `content_type`ã§åŒºåˆ¥ã™ã‚‹ã®ã§å•é¡Œãªã„

#### 3. BlockRenderer.tsx

**å ´æ‰€**: `components/BlockRenderer.tsx`

**ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•**:
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç”¨ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã‚’ãƒ™ãƒ¼ã‚¹ã«
- ãƒ“ã‚¸ãƒã‚¹LPç”¨ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ 
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’PCå‘ã‘ã«èª¿æ•´

**ä¾‹**: Hero ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆãƒ“ã‚¸ãƒã‚¹LPå°‚ç”¨ï¼‰
```typescript
// ãƒ“ã‚¸ãƒã‚¹LPç”¨ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ 
type HeroBlockData = {
  title: string;
  subtitle: string;
  backgroundImage: string;
  ctaText: string;
  ctaUrl: string;
};

// BlockRendererã«è¿½åŠ 
case 'hero':
  return <HeroBlock data={block.data as HeroBlockData} />;
```

---

## Server Actionsã®æ´»ç”¨

### analytics.ts ã®ä½¿ã„æ–¹

**å ´æ‰€**: `app/actions/analytics.ts`

#### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç”¨

```typescript
import { saveAnalytics, getAnalytics } from '@/app/actions/analytics';

// ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã‚’è¨˜éŒ²
await saveAnalytics(
  profileId,      // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ID
  'view',         // ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—
  undefined,      // ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  'profile'       // â† content_type ã‚’ 'profile' ã«è¨­å®š
);

// ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚’å–å¾—
const analytics = await getAnalytics(profileId);
```

#### ãƒ“ã‚¸ãƒã‚¹LPç”¨

```typescript
import { saveAnalytics, getAnalytics } from '@/app/actions/analytics';

// ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã‚’è¨˜éŒ²
await saveAnalytics(
  projectId,      // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID
  'view',         // ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—
  undefined,      // ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  'business'      // â† content_type ã‚’ 'business' ã«è¨­å®š
);

// ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚’å–å¾—ï¼ˆè¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰
const analytics = await getBusinessAnalytics(projectId);
```

**é‡è¦**: `content_type` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¿…ãšè¨­å®šï¼

#### getAnalytics ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

`app/actions/analytics.ts` ã® `getAnalytics` é–¢æ•°ã¯ã€`content_type='profile'` ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚

**ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç‰ˆ**:
```typescript
// 82è¡Œç›®
.eq('content_type', 'profile'); // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPã®ãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—
```

**ãƒ“ã‚¸ãƒã‚¹LPç‰ˆã«å¤‰æ›´**:
```typescript
// æ–°ã—ã„é–¢æ•°ã‚’ä½œæˆ
export async function getBusinessAnalytics(projectId: string) {
  if (!supabase) {
    console.error('[Analytics] Supabase not available');
    return { views: 0, clicks: 0, avgScrollDepth: 0, avgTimeSpent: 0, readRate: 0, clickRate: 0 };
  }

  try {
    const { data: allEvents, error } = await supabase
      .from('analytics')
      .select('*')
      .eq('profile_id', projectId)
      .eq('content_type', 'business'); // â† 'business' ã«å¤‰æ›´

    // ... ä»¥é™ã¯åŒã˜ãƒ­ã‚¸ãƒƒã‚¯
  } catch (error: any) {
    console.error('[Analytics] Fetch exception:', error);
    return { views: 0, clicks: 0, avgScrollDepth: 0, avgTimeSpent: 0, readRate: 0, clickRate: 0 };
  }
}
```

### profiles.ts ã®å¿œç”¨

**å ´æ‰€**: `app/actions/profiles.ts`

#### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç‰ˆ

```typescript
export async function saveProfile(data: {
  slug: string;
  nickname?: string | null;
  content: Block[];
  settings: any;
  userId: string | null;
  featuredOnTop?: boolean;
}) {
  if (!supabase) {
    return { error: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“' };
  }

  try {
    const { data: result, error } = await supabase
      .from('profiles')  // â† ãƒ†ãƒ¼ãƒ–ãƒ«å
      .upsert({
        slug: data.slug,
        nickname: data.nickname || null,
        content: data.content,
        settings: data.settings,
        user_id: data.userId,
        featured_on_top: data.featuredOnTop ?? true,
        updated_at: new Date().toISOString()
      }, {
        onConflict: 'slug'
      })
      .select()
      .single();

    if (error) {
      console.error('Profile save error:', error);
      return { error: error.message };
    }

    return { success: true, data: result };
  } catch (error: any) {
    console.error('Profile save error:', error);
    return { error: error.message };
  }
}
```

#### ãƒ“ã‚¸ãƒã‚¹LPç‰ˆã«å¤‰æ›´

**æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«**: `app/actions/business.ts`

```typescript
'use server';

import { supabase } from '@/lib/supabase';
import { Block } from '@/lib/types';

export async function saveBusinessProject(data: {
  slug: string;
  nickname?: string | null;
  content: Block[];
  settings: any;
  userId: string | null;
  featuredOnTop?: boolean;
}) {
  if (!supabase) {
    return { error: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“' };
  }

  try {
    const { data: result, error } = await supabase
      .from('business_projects')  // â† ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’å¤‰æ›´
      .upsert({
        slug: data.slug,
        nickname: data.nickname || null,
        content: data.content,
        settings: data.settings,
        user_id: data.userId,
        featured_on_top: data.featuredOnTop ?? true,
        updated_at: new Date().toISOString()
      }, {
        onConflict: 'slug'
      })
      .select()
      .single();

    if (error) {
      console.error('Business project save error:', error);
      return { error: error.message };
    }

    return { success: true, data: result };
  } catch (error: any) {
    console.error('Business project save error:', error);
    return { error: error.message };
  }
}
```

**å¤‰æ›´ç‚¹**:
- ãƒ†ãƒ¼ãƒ–ãƒ«å: `profiles` â†’ `business_projects`
- é–¢æ•°å: `saveProfile` â†’ `saveBusinessProject`
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: `Profile` â†’ `Business project`

---

## æ±ºæ¸ˆå‡¦ç†ã®å®Ÿè£…

### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç‰ˆã®æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼

**å ´æ‰€**: `app/api/checkout-profile/route.js`

```javascript
export async function POST(req) {
  try {
    const { profileId, profileName, userId, email, price } = await req.json();
    
    // Stripe Checkout Sessionä½œæˆ
    const session = await stripe.checkout.sessions.create({
      payment_method_types: ['card'],
      line_items: [{
        price_data: {
          currency: 'jpy',
          product_data: {
            name: `HTMLãƒ‡ãƒ¼ã‚¿æä¾›: ${profileName}`,
            description: 'ã“ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPã®HTMLãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆå¯„ä»˜ãƒ»å¿œæ´ï¼‰',
          },
          unit_amount: finalPrice,
        },
        quantity: 1,
      }],
      mode: 'payment',
      success_url: `${origin}/?payment=success&session_id={CHECKOUT_SESSION_ID}&profile_id=${profileId}&page=dashboard`,
      cancel_url: `${origin}/?payment=cancel&page=dashboard`,
      metadata: {
        userId: userId,
        profileId: profileId,
      },
      customer_email: email,
    });

    return NextResponse.json({ url: session.url });
  } catch (err) {
    console.error("Stripe Checkout Error:", err);
    return NextResponse.json({ error: err.message }, { status: 500 });
  }
}
```

### ãƒ“ã‚¸ãƒã‚¹LPç‰ˆã«å¤‰æ›´

**æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/business-checkout/route.js`

```javascript
import { NextResponse } from 'next/server';
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY || '');

export async function POST(req) {
  try {
    const { projectId, projectName, userId, email, price } = await req.json();
    
    // ä¾¡æ ¼ãƒã‚§ãƒƒã‚¯
    let finalPrice = parseInt(price);
    if (isNaN(finalPrice) || finalPrice < 500 || finalPrice > 100000) {
      finalPrice = 1000;
    }

    let origin = req.headers.get('origin');
    if (!origin) {
      origin = req.headers.get('referer');
      if (origin) {
        origin = new URL(origin).origin;
      }
    }
    if (!origin || origin === 'null') {
      origin = process.env.NEXT_PUBLIC_SITE_URL || 'https://business-lp.makers.tokyo';
    }

    console.log(`ğŸš€ Starting Business Checkout: ${projectName} / ${finalPrice}JPY / User:${userId}`);

    const session = await stripe.checkout.sessions.create({
      payment_method_types: ['card'],
      line_items: [{
        price_data: {
          currency: 'jpy',
          product_data: {
            name: `HTMLãƒ‡ãƒ¼ã‚¿æä¾›: ${projectName}`,
            description: 'ã“ã®ãƒ“ã‚¸ãƒã‚¹LPã®HTMLãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆå¯„ä»˜ãƒ»å¿œæ´ï¼‰',
          },
          unit_amount: finalPrice,
        },
        quantity: 1,
      }],
      mode: 'payment',
      success_url: `${origin}/?payment=success&session_id={CHECKOUT_SESSION_ID}&project_id=${projectId}&page=business-dashboard`,
      cancel_url: `${origin}/?payment=cancel&page=business-dashboard`,
      metadata: {
        userId: userId,
        projectId: projectId,  // â† profileId ã‹ã‚‰ projectId ã«å¤‰æ›´
      },
      customer_email: email,
    });

    return NextResponse.json({ url: session.url });
  } catch (err) {
    console.error("ğŸ”¥ Stripe Checkout Error:", err);
    return NextResponse.json({ error: err.message }, { status: 500 });
  }
}
```

**å¤‰æ›´ç‚¹**:
1. `profileId` â†’ `projectId`
2. `profileName` â†’ `projectName`
3. `success_url`: `profile_id` â†’ `project_id`
4. `success_url`: `page=dashboard` â†’ `page=business-dashboard`
5. `cancel_url`: `page=dashboard` â†’ `page=business-dashboard`
6. `metadata.profileId` â†’ `metadata.projectId`
7. å•†å“èª¬æ˜: `ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LP` â†’ `ãƒ“ã‚¸ãƒã‚¹LP`

### æ±ºæ¸ˆæ¤œè¨¼API

**æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/business-verify/route.js`

```javascript
import { NextResponse } from 'next/server';
import Stripe from 'stripe';
import { createClient } from '@supabase/supabase-js';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY || '');
const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL || '',
  process.env.SUPABASE_SERVICE_ROLE_KEY || ''
);

export async function POST(req) {
  try {
    const { sessionId, projectId, userId } = await req.json();

    // Stripeã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—
    const session = await stripe.checkout.sessions.retrieve(sessionId);

    if (session.payment_status !== 'paid') {
      return NextResponse.json({ error: 'æ±ºæ¸ˆãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“' }, { status: 400 });
    }

    // è³¼å…¥å±¥æ­´ã‚’è¨˜éŒ²
    const { data, error } = await supabase
      .from('business_project_purchases')  // â† ãƒ†ãƒ¼ãƒ–ãƒ«åå¤‰æ›´
      .insert([{
        user_id: userId,
        project_id: projectId,  // â† profile_id ã‹ã‚‰ project_id ã«å¤‰æ›´
        stripe_session_id: sessionId,
        amount: session.amount_total,
      }])
      .select()
      .single();

    if (error) {
      // é‡è¤‡ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
      if (error.code === '23505') {
        const { data: existing } = await supabase
          .from('business_project_purchases')
          .select('*')
          .eq('stripe_session_id', sessionId)
          .single();
        
        return NextResponse.json({ success: true, purchase: existing, alreadyProcessed: true });
      }
      throw error;
    }

    return NextResponse.json({ success: true, purchase: data });
  } catch (err) {
    console.error('ğŸ”¥ Verify Error:', err);
    return NextResponse.json({ error: err.message }, { status: 500 });
  }
}
```

**å¤‰æ›´ç‚¹**:
1. ãƒ†ãƒ¼ãƒ–ãƒ«å: `profile_purchases` â†’ `business_project_purchases`
2. ã‚«ãƒ©ãƒ å: `profile_id` â†’ `project_id`

### ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLã®è¨­å®šãƒŸã‚¹ã‚’é˜²ãæ–¹æ³•

#### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `success_url` ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯æ­£ã—ã„ã‹ï¼Ÿ
  - `profile_id` â†’ `project_id`
  - `page=dashboard` â†’ `page=business-dashboard`
- [ ] `cancel_url` ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯æ­£ã—ã„ã‹ï¼Ÿ
- [ ] `metadata` ã®ã‚­ãƒ¼ã¯æ­£ã—ã„ã‹ï¼Ÿ
- [ ] ç’°å¢ƒå¤‰æ•° `NEXT_PUBLIC_SITE_URL` ã¯æ­£ã—ã„ã‹ï¼Ÿ

#### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

```javascript
// æ±ºæ¸ˆå‰ã«URLã‚’ç¢ºèª
console.log('Success URL:', session.success_url);
console.log('Cancel URL:', session.cancel_url);
console.log('Metadata:', session.metadata);
```

---

## ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®å®Ÿè£…

### ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½¿ã„æ–¹

#### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç‰ˆ

```typescript
import { ProfileViewTracker } from '@/components/ProfileViewTracker';
import { LinkClickTracker } from '@/components/LinkClickTracker';

// ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
<ProfileViewTracker 
  profileId={profile.id} 
  contentType="profile"
/>

// ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
const { handleClick } = LinkClickTracker({ 
  profileId: profile.id, 
  url: link.url 
});
```

#### ãƒ“ã‚¸ãƒã‚¹LPç‰ˆ

```typescript
import { BusinessViewTracker } from '@/components/BusinessViewTracker';
import { LinkClickTracker } from '@/components/LinkClickTracker';

// ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
<BusinessViewTracker 
  projectId={project.id} 
  contentType="business"  // â† å¿…ãš 'business' ã«è¨­å®š
/>

// ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆãã®ã¾ã¾ä½¿ãˆã‚‹ï¼‰
const { handleClick } = LinkClickTracker({ 
  profileId: project.id,  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’æ¸¡ã™
  url: link.url 
});
```

### content_type ã®è¨­å®šã‚’å¿˜ã‚Œãªã„ãŸã‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `saveAnalytics` ã®ç¬¬4å¼•æ•°ã« `'business'` ã‚’è¨­å®šã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] `ProfileViewTracker` ã‚’ `BusinessViewTracker` ã«ã‚³ãƒ”ãƒ¼ã—ãŸã‹ï¼Ÿ
- [ ] `BusinessViewTracker` ã® `contentType` ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ `'business'` ã«ã—ãŸã‹ï¼Ÿ
- [ ] `getBusinessAnalytics` é–¢æ•°ã§ `content_type='business'` ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

### ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®å–å¾—ä¾‹

```typescript
import { getBusinessAnalytics } from '@/app/actions/analytics';

const analytics = await getBusinessAnalytics(projectId);

console.log('ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼:', analytics.views);
console.log('ã‚¯ãƒªãƒƒã‚¯æ•°:', analytics.clicks);
console.log('ã‚¯ãƒªãƒƒã‚¯ç‡:', analytics.clickRate);
console.log('ç²¾èª­ç‡:', analytics.readRate);
console.log('å¹³å‡æ»åœ¨æ™‚é–“:', analytics.avgTimeSpent);
```

---

## ã‚ˆãã‚ã‚‹ãƒã‚°ã¨å¯¾ç­–

### 1. URLãƒªãƒ³ã‚¯é–“é•ã„

#### ç—‡çŠ¶
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚Œãªã„
- å…¬é–‹ãƒšãƒ¼ã‚¸ãŒ404ã‚¨ãƒ©ãƒ¼
- æ±ºæ¸ˆå¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒå¤±æ•—

#### åŸå› 
- ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ `/p/` ã‚„ `/dashboard` ã‚’ãã®ã¾ã¾ä½¿ã£ã¦ã„ã‚‹
- ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLã®è¨­å®šãƒŸã‚¹

#### å¯¾ç­–

**æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰**:
```bash
# ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç‰¹æœ‰ã®ãƒ‘ã‚¹ã‚’æ¤œç´¢
grep -r "/p/" --include="*.tsx" --include="*.jsx" app/ components/
grep -r "/dashboard" --include="*.tsx" --include="*.jsx" app/ components/
grep -r "page=dashboard" --include="*.tsx" --include="*.jsx" --include="*.js" app/
```

**ç½®æ›ä¾‹**:
```javascript
// Before
window.location.href = '/dashboard';
const url = `/p/${slug}`;
success_url: `${origin}/?page=dashboard`

// After
window.location.href = '/business/dashboard';
const url = `/b/${slug}`;
success_url: `${origin}/?page=business-dashboard`
```

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«åã®é–“é•ã„

#### ç—‡çŠ¶
- ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œãªã„
- ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„
- ã‚¨ãƒ©ãƒ¼: `relation "profiles" does not exist`

#### åŸå› 
- ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’ `profiles` ã®ã¾ã¾ä½¿ã£ã¦ã„ã‚‹
- ã‚«ãƒ©ãƒ åã‚’ `profile_id` ã®ã¾ã¾ä½¿ã£ã¦ã„ã‚‹

#### å¯¾ç­–

**æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰**:
```bash
# ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æ¤œç´¢
grep -r "\.from('profiles')" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/
grep -r "profile_id" --include="*.ts" --include="*.tsx" app/
```

**ç½®æ›ä¾‹**:
```typescript
// Before
.from('profiles')
.eq('profile_id', profileId)

// After
.from('business_projects')
.eq('project_id', projectId)
```

### 3. ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®æ··åœ¨

#### ç—‡çŠ¶
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPã®ã‚¢ã‚¯ã‚»ã‚¹æ•°ã«ãƒ“ã‚¸ãƒã‚¹LPã®ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã‚‹
- ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãŒæ­£ã—ãé›†è¨ˆã•ã‚Œãªã„

#### åŸå› 
- `content_type` ã®è¨­å®šæ¼ã‚Œ
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®é–“é•ã„

#### å¯¾ç­–

**æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰**:
```bash
# content_type ã®è¨­å®šã‚’ç¢ºèª
grep -r "saveAnalytics" --include="*.ts" --include="*.tsx" app/ components/
grep -r "content_type" --include="*.ts" --include="*.tsx" app/
```

**æ­£ã—ã„å®Ÿè£…**:
```typescript
// ãƒ“ã‚¸ãƒã‚¹LPç”¨
await saveAnalytics(projectId, 'view', undefined, 'business');

// å–å¾—æ™‚ã‚‚ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
.eq('content_type', 'business')
```

### 4. æ±ºæ¸ˆå‡¦ç†ã®æ··åœ¨

#### ç—‡çŠ¶
- è³¼å…¥å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œãªã„
- Proæ©Ÿèƒ½ãŒé–‹æ”¾ã•ã‚Œãªã„
- ã‚¨ãƒ©ãƒ¼: `relation "profile_purchases" does not exist`

#### åŸå› 
- è³¼å…¥å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«åã®é–“é•ã„
- ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯æ¼ã‚Œ

#### å¯¾ç­–

**æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰**:
```bash
# è³¼å…¥å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢
grep -r "profile_purchases" --include="*.ts" --include="*.js" app/
```

**æ­£ã—ã„å®Ÿè£…**:
```typescript
// ãƒ“ã‚¸ãƒã‚¹LPç”¨
.from('business_project_purchases')
.eq('project_id', projectId)
```

---

## ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ»ç½®æ›ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPã‹ã‚‰ãƒ“ã‚¸ãƒã‚¹LPã¸ã®ç§»è¡Œæ™‚

#### 1. URLãƒ»ãƒ‘ã‚¹ã®æ¤œç´¢

```bash
# ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPç‰¹æœ‰ã®ãƒ‘ã‚¹ã‚’æ¤œç´¢
grep -rn "/p/" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/ components/
grep -rn "/dashboard" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/ components/
grep -rn "page=dashboard" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/
```

**ç½®æ›å¯¾è±¡**:
- `/p/` â†’ `/b/`
- `/dashboard` â†’ `/business/dashboard`
- `page=dashboard` â†’ `page=business-dashboard`

#### 2. ãƒ†ãƒ¼ãƒ–ãƒ«åã®æ¤œç´¢

```bash
# ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æ¤œç´¢
grep -rn "\.from('profiles')" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/
grep -rn "profile_purchases" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/
```

**ç½®æ›å¯¾è±¡**:
- `.from('profiles')` â†’ `.from('business_projects')`
- `profile_purchases` â†’ `business_project_purchases`

#### 3. å¤‰æ•°åãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã®æ¤œç´¢

```bash
# å¤‰æ•°åã‚’æ¤œç´¢
grep -rn "profileId" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/ components/
grep -rn "profile_id" --include="*.ts" --include="*.tsx" app/
```

**ç½®æ›å¯¾è±¡**:
- `profileId` â†’ `projectId`ï¼ˆå¤‰æ•°åï¼‰
- `profile_id` â†’ `project_id`ï¼ˆã‚«ãƒ©ãƒ åï¼‰

#### 4. content_type ã®æ¤œç´¢

```bash
# content_type ã®è¨­å®šã‚’ç¢ºèª
grep -rn "saveAnalytics" --include="*.ts" --include="*.tsx" app/ components/
grep -rn "content_type.*profile" --include="*.ts" --include="*.tsx" app/
```

**ç¢ºèªäº‹é …**:
- `saveAnalytics` ã®ç¬¬4å¼•æ•°ãŒ `'business'` ã«ãªã£ã¦ã„ã‚‹ã‹
- `getAnalytics` ã§ `content_type='business'` ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã‹

#### 5. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ¤œç´¢

```bash
# APIå‘¼ã³å‡ºã—ã‚’æ¤œç´¢
grep -rn "/api/checkout-profile" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/ components/
grep -rn "/api/verify-profile" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/ components/
grep -rn "/api/delete-profile" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/ components/
grep -rn "/api/generate-profile" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" app/ components/
```

**ç½®æ›å¯¾è±¡**:
- `/api/checkout-profile` â†’ `/api/business-checkout`
- `/api/verify-profile` â†’ `/api/business-verify`
- `/api/delete-profile` â†’ `/api/business-delete`
- `/api/generate-profile` â†’ `/api/business-generate`

### ä¸€æ‹¬ç½®æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆPowerShellï¼‰

```powershell
# ãƒ“ã‚¸ãƒã‚¹LPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ

# URLãƒ»ãƒ‘ã‚¹ã®ç½®æ›
Get-ChildItem -Recurse -Include *.ts,*.tsx,*.js,*.jsx | 
  ForEach-Object {
    (Get-Content $_.FullName) -replace '/p/', '/b/' |
    Set-Content $_.FullName
  }

Get-ChildItem -Recurse -Include *.ts,*.tsx,*.js,*.jsx | 
  ForEach-Object {
    (Get-Content $_.FullName) -replace 'page=dashboard', 'page=business-dashboard' |
    Set-Content $_.FullName
  }

# ãƒ†ãƒ¼ãƒ–ãƒ«åã®ç½®æ›
Get-ChildItem -Recurse -Include *.ts,*.tsx,*.js,*.jsx | 
  ForEach-Object {
    (Get-Content $_.FullName) -replace "\.from\('profiles'\)", ".from('business_projects')" |
    Set-Content $_.FullName
  }

Get-ChildItem -Recurse -Include *.ts,*.tsx,*.js,*.jsx | 
  ForEach-Object {
    (Get-Content $_.FullName) -replace 'profile_purchases', 'business_project_purchases' |
    Set-Content $_.FullName
  }

# API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç½®æ›
Get-ChildItem -Recurse -Include *.ts,*.tsx,*.js,*.jsx | 
  ForEach-Object {
    (Get-Content $_.FullName) -replace '/api/checkout-profile', '/api/business-checkout' |
    Set-Content $_.FullName
  }

Get-ChildItem -Recurse -Include *.ts,*.tsx,*.js,*.jsx | 
  ForEach-Object {
    (Get-Content $_.FullName) -replace '/api/verify-profile', '/api/business-verify' |
    Set-Content $_.FullName
  }

Write-Host "ç½®æ›å®Œäº†ï¼å¿…ãšå†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚" -ForegroundColor Green
```

**æ³¨æ„**: 
- ä¸€æ‹¬ç½®æ›ã¯æ…é‡ã«ï¼
- å¿…ãšGitã§ã‚³ãƒŸãƒƒãƒˆã—ã¦ã‹ã‚‰å®Ÿè¡Œ
- ç½®æ›å¾Œã¯å¿…ãšå‹•ä½œç¢ºèª

---

## å®Ÿè£…ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

### ãƒ“ã‚¸ãƒã‚¹LPæ©Ÿèƒ½å®Ÿè£…ã®æµã‚Œ

```mermaid
graph TB
    Start[ãƒ“ã‚¸ãƒã‚¹LPæ©Ÿèƒ½å®Ÿè£…é–‹å§‹]
    
    CheckCommon[å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèª]
    UseCommon[ãã®ã¾ã¾ä½¿ç”¨]
    CustomizeComponent[ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ä½¿ç”¨]
    
    CheckDB[DBè¨­è¨ˆç¢ºèª]
    CreateTable[business_projectsãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ]
    UpdateAnalytics[analyticsã«content_typeè¿½åŠ ]
    CreatePurchases[business_project_purchasesãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ]
    
    CheckRouting[ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç¢ºèª]
    CreateRoutes[/b/slug, /business/dashboardä½œæˆ]
    
    CheckActions[Server Actionsç¢ºèª]
    CreateActions[ãƒ“ã‚¸ãƒã‚¹ç”¨Actionsä½œæˆ]
    
    CheckPayment[æ±ºæ¸ˆå‡¦ç†ç¢ºèª]
    CreatePaymentAPI[business-checkout/verifyä½œæˆ]
    
    CheckAnalytics[ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ç¢ºèª]
    SetContentType[content_type='business'è¨­å®š]
    
    Testing[URLãƒªãƒ³ã‚¯ãƒ†ã‚¹ãƒˆ]
    Deploy[ãƒ‡ãƒ—ãƒ­ã‚¤]
    
    Start --> CheckCommon
    CheckCommon --> UseCommon
    CheckCommon --> CustomizeComponent
    
    UseCommon --> CheckDB
    CustomizeComponent --> CheckDB
    
    CheckDB --> CreateTable
    CheckDB --> UpdateAnalytics
    CheckDB --> CreatePurchases
    
    CreateTable --> CheckRouting
    UpdateAnalytics --> CheckRouting
    CreatePurchases --> CheckRouting
    
    CheckRouting --> CreateRoutes
    CreateRoutes --> CheckActions
    
    CheckActions --> CreateActions
    CreateActions --> CheckPayment
    
    CheckPayment --> CreatePaymentAPI
    CreatePaymentAPI --> CheckAnalytics
    
    CheckAnalytics --> SetContentType
    SetContentType --> Testing
    
    Testing --> Deploy
```

### å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æº–å‚™

- [ ] `business_projects` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
- [ ] `business_project_purchases` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
- [ ] `analytics` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `content_type='business'` ã‚’è¿½åŠ 
- [ ] RLSãƒãƒªã‚·ãƒ¼ã‚’è¨­å®š

#### Phase 2: å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æº–å‚™

- [ ] `Header.jsx` ã‚’ãã®ã¾ã¾ä½¿ç”¨
- [ ] `Footer.jsx` ã‚’ãã®ã¾ã¾ä½¿ç”¨
- [ ] `AuthModal.jsx` ã‚’ãã®ã¾ã¾ä½¿ç”¨
- [ ] `AnnouncementBanner.jsx` ã‚’ `serviceType="business"` ã§ä½¿ç”¨
- [ ] `ProfileViewTracker.tsx` ã‚’ `BusinessViewTracker.tsx` ã«ã‚³ãƒ”ãƒ¼ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- [ ] `LinkClickTracker.tsx` ã‚’ãã®ã¾ã¾ä½¿ç”¨

#### Phase 3: Server Actions ã®ä½œæˆ

- [ ] `app/actions/business.ts` ã‚’ä½œæˆ
- [ ] `saveBusinessProject` é–¢æ•°ã‚’å®Ÿè£…
- [ ] `getBusinessAnalytics` é–¢æ•°ã‚’å®Ÿè£…ï¼ˆ`content_type='business'`ï¼‰

#### Phase 4: API Routes ã®ä½œæˆ

- [ ] `app/api/business-checkout/route.js` ã‚’ä½œæˆ
- [ ] `app/api/business-verify/route.js` ã‚’ä½œæˆ
- [ ] `app/api/business-delete/route.js` ã‚’ä½œæˆ
- [ ] `app/api/business-generate/route.js` ã‚’ä½œæˆï¼ˆAIç”Ÿæˆæ©Ÿèƒ½ï¼‰

#### Phase 5: ãƒšãƒ¼ã‚¸ã®ä½œæˆ

- [ ] `app/b/[slug]/page.tsx` ã‚’ä½œæˆï¼ˆå…¬é–‹ãƒšãƒ¼ã‚¸ï¼‰
- [ ] `app/b/[slug]/flyer/page.tsx` ã‚’ä½œæˆï¼ˆãƒãƒ©ã‚·å°åˆ·ï¼‰
- [ ] `app/business/dashboard/page.tsx` ã‚’ä½œæˆï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰
- [ ] `app/business/dashboard/editor/new/page.tsx` ã‚’ä½œæˆï¼ˆæ–°è¦ä½œæˆï¼‰
- [ ] `app/business/dashboard/editor/[slug]/page.tsx` ã‚’ä½œæˆï¼ˆç·¨é›†ï¼‰

#### Phase 6: URLãƒªãƒ³ã‚¯ã®ç¢ºèª

- [ ] ã™ã¹ã¦ã® `/p/` ã‚’ `/b/` ã«ç½®æ›
- [ ] ã™ã¹ã¦ã® `/dashboard` ã‚’ `/business/dashboard` ã«ç½®æ›
- [ ] ã™ã¹ã¦ã® `page=dashboard` ã‚’ `page=business-dashboard` ã«ç½®æ›
- [ ] APIå‘¼ã³å‡ºã—ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèª

#### Phase 7: ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®ç¢ºèª

- [ ] `saveAnalytics` ã® `content_type` ãŒ `'business'` ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
- [ ] `getBusinessAnalytics` ã§ `content_type='business'` ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- [ ] ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ç¢ºèª

#### Phase 8: æ±ºæ¸ˆå‡¦ç†ã®ç¢ºèª

- [ ] æ±ºæ¸ˆAPIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ã„ã‹ç¢ºèª
- [ ] ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLãŒæ­£ã—ã„ã‹ç¢ºèª
- [ ] ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ã„ã‹ç¢ºèª
- [ ] è³¼å…¥å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ­£ã—ã„ã‹ç¢ºèª

#### Phase 9: ãƒ†ã‚¹ãƒˆ

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
- [ ] å…¬é–‹ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºç¢ºèª
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å‹•ä½œç¢ºèª
- [ ] ã‚¨ãƒ‡ã‚£ã‚¿ã®å‹•ä½œç¢ºèª
- [ ] æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®å‹•ä½œç¢ºèª

#### Phase 10: ãƒ‡ãƒ—ãƒ­ã‚¤

- [ ] ç’°å¢ƒå¤‰æ•°ã®è¨­å®šç¢ºèª
- [ ] Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] æœ¬ç•ªç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ

---

## ã¾ã¨ã‚

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’å¿…ãšå¤‰æ›´ã™ã‚‹**
   - `profiles` â†’ `business_projects`
   - `profile_purchases` â†’ `business_project_purchases`

2. **content_type ã‚’å¿…ãšè¨­å®šã™ã‚‹**
   - ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ä¿å­˜æ™‚: `content_type='business'`
   - ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹å–å¾—æ™‚: `.eq('content_type', 'business')`

3. **URLãƒ»ãƒ‘ã‚¹ã‚’å¿…ãšå¤‰æ›´ã™ã‚‹**
   - `/p/` â†’ `/b/`
   - `/dashboard` â†’ `/business/dashboard`
   - `page=dashboard` â†’ `page=business-dashboard`

4. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å¿…ãšå¤‰æ›´ã™ã‚‹**
   - `/api/checkout-profile` â†’ `/api/business-checkout`
   - `/api/verify-profile` â†’ `/api/business-verify`

5. **å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ´»ç”¨ã™ã‚‹**
   - `Header.jsx`, `Footer.jsx`, `AuthModal.jsx` ã¯ãã®ã¾ã¾ä½¿ãˆã‚‹
   - `ProfileViewTracker.tsx` ã¯ `BusinessViewTracker.tsx` ã«ã‚³ãƒ”ãƒ¼ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªï¼š

1. **URLãƒªãƒ³ã‚¯ã®ç¢ºèª**
   ```bash
   grep -r "/p/" --include="*.tsx" --include="*.jsx" app/ components/
   ```

2. **ãƒ†ãƒ¼ãƒ–ãƒ«åã®ç¢ºèª**
   ```bash
   grep -r "\.from('profiles')" --include="*.ts" --include="*.tsx" app/
   ```

3. **content_type ã®ç¢ºèª**
   ```bash
   grep -r "saveAnalytics" --include="*.ts" --include="*.tsx" app/ components/
   ```

4. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç¢ºèª**
   ```bash
   grep -r "/api/checkout-profile" --include="*.ts" --include="*.tsx" app/ components/
   ```

### ã‚µãƒãƒ¼ãƒˆ

ã“ã®ã‚¬ã‚¤ãƒ‰ã«é–¢ã™ã‚‹è³ªå•ã‚„å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«LPãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºè€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2024å¹´12æœˆ18æ—¥

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0

